# 视音频编解码基础

- [视音频编解码基础](#视音频编解码基础)
  - [视频播放器原理](#视频播放器原理)
  - [流媒体协议](#流媒体协议)
  - [封装格式](#封装格式)
  - [视频编码](#视频编码)
  - [音频编码](#音频编码)
- [参考资料](#参考资料)

## 视频播放器原理

视音频技术主要包含以下几点：封装技术，视频压缩编码技术以及音频压缩编码技术。如果考虑到网络传输的话，还包括流媒体协议技术。

视频播放器播放一个视频文件，需要经过以下几个步骤：解协议，解封装，解码视音频，视音频同步。如果播放本地文件则不需要解协议，为以下几个步骤：解封装，解码视音频，视音频同步。他们的过程如图所示。

<p style="text-align: center;"><img src="../resource/img/20140201120523046.jpg"/></p>

**解协议**的作用，就是将流媒体协议的数据，解析为标准的相应的封装格式数据。视音频在网络上传播的时候，常常采用各种流媒体协议，例如HTTP，RTMP，或是MMS等等。这些协议在传输视音频数据的同时，也会传输一些信令数据。这些信令数据包括对播放的控制（播放，暂停，停止），或者对网络状态的描述等。解协议的过程中会去除掉信令数据而只保留视音频数据。例如，采用RTMP协议传输的数据，经过解协议操作后，输出FLV格式的数据。

**解封装**的作用，就是将输入的封装格式的数据，分离成为音频流压缩编码数据和视频流压缩编码数据。封装格式种类很多，例如MP4，MKV，RMVB，TS，FLV，AVI等等，它的作用就是将已经压缩编码的视频数据和音频数据按照一定的格式放到一起。例如，FLV格式的数据，经过解封装操作后，输出H.264编码的视频码流和AAC编码的音频码流。

**解码**的作用，就是将视频/音频压缩编码数据，解码成为非压缩的视频/音频原始数据。音频的压缩编码标准包含AAC，MP3，AC-3等等，视频的压缩编码标准则包含H.264，MPEG2，VC-1等等。解码是整个系统中最重要也是最复杂的一个环节。通过解码，压缩编码的视频数据输出成为非压缩的颜色数据，例如YUV420P，RGB等等；压缩编码的音频数据输出成为非压缩的音频抽样数据，例如PCM数据。

**视音频同步**的作用，就是根据解封装模块处理过程中获取到的参数信息，同步解码出来的视频和音频数据，并将视频音频数据送至系统的显卡和声卡播放出来。

##  流媒体协议

流媒体协议是服务器与客户端之间通信遵循的规定。当前网络上主要的流媒体协议如表所示。

常见流媒体协议一览：

名称 | 推出机构 | 传输层协议 | 客户端 | 主要使用领域
---|---|---|---|---
RTSP+RTP | IETF           | TCP + UDP | VLC,WMP | IPTV
RTMP     | Adobe Inc.     | TCP       | Flash   | 互联网直播
RTMFP    | Adobe Inc.     | UDP       | Flash   | 互联网直播
MMS      | Microsoft Inc. | TCP/UDP   | WMP     | 互联网直播+点播
HLS      | Apple Inc.     | TCP       | Web     | 互联网直播+点播

## 封装格式

封装格式的主要作用是把视频码流和音频码流按照一定的格式存储在一个文件中。现如今流行的封装格式如下表所示。

名称 | 推出机构 | 流媒体 | 支持的视频编码 | 支持的音频编码 | 目前使用领域
---|---|---|---|---|---|---
AVI  | Microsoft Inc. | 不支持 | 几乎所有格式 | 几乎所有格式 | BT下载影视
MP4  | MPEG           | 支持   | MPEG-2, MPEG-4, H.264, H.263等 | AAC, MPEG-1 Layers I, II, III, AC-3等 | 互联网视频网站
TS   | MPEG           | 支持   | MPEG-1, MPEG-2, MPEG-4, H.264 | MPEG-1 Layers I, II, III, AAC | IPTV，数字电视
FLV  | Adobe Inc.     | 支持   | Sorenson, VP6, H.264 | MP3, ADPCM, Linear PCM, AAC等 | 互联网视频网站
MKV  | CoreCodec Inc. | 支持   | 几乎所有格式 | 几乎所有格式 | 互联网视频网站
RMVB | Real Networks Inc. | 支持 | RealVideo 8, 9, 10 | AAC, Cook Codec, RealAudio Lossless | BT下载影视

由表可见，除了AVI之外，其他封装格式都支持流媒体，即可以“边下边播”。有些格式更“万能”一些，支持的视音频编码标准多一些，比如MKV。而有些格式则支持的相对比较少，比如说RMVB。

## 视频编码

视频编码的主要作用是将视频像素数据（RGB，YUV等）压缩成为视频码流，从而降低视频的数据量。如果视频不经过压缩编码的话，体积通常是非常大的，一部电影可能就要上百G的空间。视频编码是视音频技术中最重要的技术之一。视频码流的数据量占了视音频总数据量的绝大部分。高效率的视频编码在同等的码率下，可以获得更高的视频质量。

主要视频编码一览：

名称 | 推出机构 | 推出时间 | 目前使用领域
---|---|---|---
HEVC(H.265) | MPEG/ITU-T   | 2013 | 各个领域
H.264       | MPEG/ITU-T   | 2003 | 各个领域
MPEG4       | MPEG         | 2001 | 不温不火
MPEG2       | MPEG         | 1994 | 数字电视
VP9         | MPEG         | 2013 | Web/WebRTC
VP8         | MPEG         | 2008 | Web/WebRTC
VC-1        | Microsoft Inc.| 2006 | 微软平台
AV1         | AOMedia      | 2016 | 研发中

由表可见，有两种视频编码方案是最新推出的：VP9和HEVC。目前这两种方案都处于研发阶段，还没有到达实用的程度。当前使用最多的视频编码方案就是H.264。

**AV1**(AOMedia Video 1)是由开放媒体联盟(AOMedia)于VP9的继任者开发的，联盟创建AV1的动机包括HEVC专利许可涉及的高成本和不确定性，HEVC是MPEG设计的编解码器，有望取代AVC。此外，联盟的七个创始成员–亚马逊，思科，谷歌，英特尔，微软，Mozilla和Netflix –宣布视频格式的最初重点将是交付高质量的网络视频。AV1的官方公告是关于开放媒体联盟成立的新闻发布的2015年9月1日。

AV1项目的许多组成部分均来自联盟成员先前的研究工作。个别贡献者早在几年前就开始了实验技术平台：Xiph / Mozilla的Daala已在2010年发布了代码，2014年9月12日宣布了Google的VP9演化实验项目VP10和Cisco的Thor在2015年8月11日发布了。VP9，AV1合并了其他技术，其中一些是以这些实验格式开发的。AV1参考编解码器的第一个版本0.1.0于2016年4月7日发布。

## 音频编码

音频编码的主要作用是将音频采样数据（PCM等）压缩成为音频码流，从而降低音频的数据量。音频编码也是互联网视音频技术中一个重要的技术。但是一般情况下音频的数据量要远小于视频的数据量，因而即使使用稍微落后的音频编码标准，而导致音频数据量有所增加，也不会对视音频的总数据量产生太大的影响。高效率的音频编码在同等的码率下，可以获得更高的音质。

主要音频编码一览：

名称 | 推出机构 | 推出时间 | 主要使用领域
---|---|---|---
AAC  | MPEG           | 1997 | 各个领域（新）
AC-3 | Dolby Inc.     | 1992 | 电影
MP3  | MPEG           | 1993 | 各个领域（旧）
WMA  | Microsoft Inc. | 1999 | 微软平台

由表可见，近年来并未推出全新的音频编码方案，可见音频编码技术已经基本可以满足人们的需要。音频编码技术近期绝大部分的改动都是在MP3的继任者——AAC的基础上完成的。

# 参考资料
- [[总结]视音频编解码技术零基础学习方法](https://blog.csdn.net/leixiaohua1020/article/details/18893769)
- [AV1](https://en.wikipedia.org/wiki/AV1)